#summary Determine if a physical interface corresponds to a Web page

= Correspondence =

A method of verifying that a program resident on a microcontroller [http://en.wikipedia.org/wiki/Correspondence_(theology) corresponds] to a particular web page is offered as a proposal. You can try this example by visiting this [http://zambetti.com/projects/seriality/examples/correspondence.html test page] while a Wiring or Arduino board is connected and running the program provided below.

== HTML/JS/Seriality ==

{{{
<html>
<head>

  <script type="text/javascript">
  
    var serial;
  
    function setup()
    {
      serial = (document.getElementById("seriality")).Seriality();
      if (!serial.begin(serial.ports[0], 9600)) {
        document.write("No physical interface");
        return;
      }
      if (!verifyPhysicalInterface()) {
        document.write("Incorrect physical interface");
        serial.end();
        return;
      }
      document.write("Correct physical interface");
    }
    
    function verifyPhysicalInterface(strict, version)
    {
      serial.write("@");
      var relation;
      var now = new Date();
      var then = new Date();
      while (now - then < 100) {
        now = new Date();
      }
      if (undefined === version) {
        version = 0;
      }
      if (undefined === strict) {
        strict = true;
      }
      if (serial.available()) {
        relation = eval('(' + serial.readJSON() + ')');
        if (undefined === relation) {
          return false;
        }
        if (version > 0) {
          if (undefined === relation.version) {
            return false;
          }
          if (relation.version < version) {
            return false;
          }
        }
        if (-1 == location.host.indexOf(relation.host)) {
          return false;
        }
        if (strict) {
          if (0 != location.pathname.indexOf(relation.path)) {
            return false;
          }
        }
        return true;
      }
      return false;
    }

  </script>

</head>
<body onload="setup();">

  <object type="application/Seriality" id="seriality" width="0" height="0"></object>

</body>
</html>
}}}

== Wiring/Arduino ==

{{{
void setup()
{
  Serial.begin(9600);
}

void loop()
{
  char in;
  if (Serial.available()) {
    in = Serial.read();
    if (in == '@') {
      Serial.print("{'host':'zambetti.com','path':'/projects/seriality/examples/correspondence.html','version':1}");
    }
  }
}
}}}