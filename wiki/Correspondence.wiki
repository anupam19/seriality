#summary Determine if a physical interface corresponds to a Web page

= Correspondence =

A method of verifying that a program resident on a microcontroller [http://en.wikipedia.org/wiki/Correspondence_(theology) corresponds] to a particular web page is offered as a proposal. You can try this example by visiting this [http://zambetti.com/projects/seriality/examples/correspondence.html test page] while a Wiring or Arduino board is connected and running the program provided below.

== HTML/JS/Seriality ==

{{{
<html>
<head>

  <script type="text/javascript">

    // create global reference
    var serial;
  
    function setup()
    {
      // instantiate seriality
      serial = (document.getElementById("seriality")).Seriality();

      // begin serial communications on first known serial port at 9600 baud, bail on failure
      if (!serial.begin(serial.ports[0], 9600)) {
        alert("No physical interface");
        return;
      }

      // verify that the physical interface corresponds to this web page, bail on failure
      if (!verifyPhysicalInterface()) {
        alert("Incorrect physical interface");
        serial.end();
        return;
      }

      // physical interface corresponds to this web page
      alert("Correct physical interface");
    }
    
    // utility function to request and parse the correspondence identifier
    function verifyPhysicalInterface(strict, version)
    {
      // request the correspondence identifier
      serial.write("@");

      // allow time for the response (100ms)
      var now = new Date();
      var then = new Date();
      while (now - then < 100) {
        now = new Date();
      }

      // optional parameter for physical interface versioning
      if (undefined === version) {
        version = 0;
      }

      // optional parameter to allow domain-wide physical interfaces by disabling strict mode
      if (undefined === strict) {
        strict = true;
      }

      // parse correspondence identifier
      if (serial.available()) {
        var identifier = eval('(' + serial.readJSON() + ')');
        if (undefined === identifier) {
          return false;
        }
        if (version > 0) {
          if (undefined === identifier.version) {
            return false;
          }
          if (identifier.version < version) {
            return false;
          }
        }
        if (-1 == location.host.indexOf(identifier.host)) {
          return false;
        }
        if (strict) {
          if (0 != location.pathname.indexOf(identifier.path)) {
            return false;
          }
        }
        return true;
      }
      return false;
    }

  </script>

</head>
<body onload="setup();">

  <h2>Correspondence Example</h2>
  <p>Determine if a physical interface corresponds to a Web page</p>
  <p>Reload this page to test</p>
  <p><a href="http://code.google.com/p/seriality/wiki/Correspondence">View documentation</a></p>

  <object type="application/Seriality" id="seriality" width="0" height="0"></object>

</body>
</html>
}}}

== Wiring/Arduino ==

{{{
void setup()
{
  Serial.begin(9600);
}

void loop()
{
  char in;
  if (Serial.available()) {
    in = Serial.read();
    // process correspondence request
    if (in == '@') {
      // reply with correspondence identifier
      Serial.print("{'host':'zambetti.com','path':'/projects/seriality/examples/correspondence.html'}");
    }
  }
}
}}}